#!/usr/bin/env node

const program = require('commander');
const pkg = require('../package.json');
const { startProcess } = require('./cmds/updates');
const { getReports } = require('./cmds/reports');
const { getTasks } = require('./cmds/status');
const { enricher } = require('./cmds/enricher');

program.on('command:*', () => {
  console.error(`Invalid command: ${program.args.join(' ')}\nSee --help for a list of available commands.`);
  process.exit(1);
});

program
  .version(pkg.version)
  .command('update')
  .option('-f --file <file>', 'snapshot\'s file installed on ezunpaywall')
  .option('-l --list', 'list of snapshot installed on ezunpaywall')
  .option('-sd --startDate <starteDate>', 'start date to download and insert updates from unpaywall')
  .option('-ed --endDate <endDate>', 'end date to download and insert updates from unpaywall')
  .option('-of --offset <offset>', 'line where processing will start')
  .option('-li --limit <limit>', 'line where processing will end')
  .description('Launch the insertions process with the snapshots present in ezunpaywall')
  .action((args) => { startProcess(args); });

program
  .version(pkg.version)
  .command('reports')
  .option('-f --file <file>', 'report file installed on ezunpaywall')
  .option('-l --list', 'list of reports generated by ezunpaywall')
  .option('-la --latest [latest]', 'boolean')
  .option('-s --status <status>', 'status of report, success and error only accepted')
  .description('get report')
  .action((args) => { getReports(args); });

program
  .version(pkg.version)
  .command('tasks')
  .description('get status of processus in courses')
  .action(() => { getTasks(); });

program
  .version(pkg.version)
  .command('enricher')
  .option('-f --file <file>', 'file which must be enriched')
  .description('enricher a file with unpaywall datas')
  .action((args) => { enricher(args); });

program.parse(process.argv);
