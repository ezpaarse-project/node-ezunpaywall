# node-ezunpaywall
> Tools for [ezunpaywall](https://github.com/ezpaarse-project/ez-unpaywall)
**Table of content**
- [Prerequisites](#prerequisites)
- [Installation](#Installation)
- [Global options](#Global-options)
- [Command line usage](#Command-line-usage)
- [Commands](#Commands)
- [Test](#Test)
## Prerequisites

The tools you need to let node-ezunpaywall run are :
* nvm
* node 14.15.2
## Installation

```bash
$ npm i -g .
```
## Global options
| Name | Type | Description |
| --- | --- | --- |
| -V, --version | Boolean | Print the version number |
| -h, --help | Boolean | Show some help |

You can get help for any command by typing `node-ezunpaywall <command> --help`.
## Command line usage
The module provides an `ezunpaywall` command (aliased `ezu`).
## Commands
### ezu config
Update config to fetch ez-unpyawall.
#### Parameters
| Name | Description |
| --- | --- |
| -g --get | display the configuration |
| -s --set | initialize the configuration file in $HOME/.config |
| -u --url | ezunpaywall url |
| -p --port | ezunpaywall port |
| -k --apikey | admin apikey |
| -l --list | list of attributes required for configuration |
#### Examples
```bash
$ ezunpaywall config --url http://localhost
$ ezunpaywall config --port 8080
$ ezunpaywall config --apikey admin
```
### ezu ping
Check if service is available.

#### Parameters
| Name | Description |
| --- | --- |
| -u --use | use a custom config |
#### Example
```bash
$ ezunpaywall ping
```
### ezu update
Starts an unpaywall data update process. If you use command update without parameter, it will download the last update published by unpaywall and insert its content. For automated this, it is possible to call this command via a cron (unpaywall publishes an update every Thursday UTC-7).
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | snapshot's file installed on ezunpaywall |
| -s --startDate | start date to download and insert updates from unpaywall |
| -e --endDate | end date to download and insert updates from unpaywall |
| -o --offset | line where processing will start |
| -l --limit | line where processing will end |
| -L --list | list of snapshot installed on ezunpaywall |
| -I --index  | name of the index to which the data is inserted |
| -U --use | use a custom config |
#### Examples
```bash
# insert the content of the selected file on list
$ ezunpaywall update -l
# insert the content between line 1 000 and 400 000 of the selected file on list
$ ezunpaywall update -l -sl 1000 -el 400000
# insert the content of fils.json.gz
$ ezunpaywall update -f ./file.jsonl.gz 
# insert the content between line 1 000 and 400 000 of fils.json.gz
$ ezunpaywall update -f ./file.jsonl.gz -sl 1000 -el 400000
# Downloads and inserts updates from unpaywall between 2020-04-27 and now
$ ezunpaywall update -sd 2020-04-27
# Downloads and inserts updates from unpaywall between 2020-04-27 and 2020-07-01 
$ ezunpaywall update -sd 2020-04-27 -se 2020-07-01
```

### ezu status
indicates if there is an update.

#### Parameters
| Name | Description |
| --- | --- |
| -U --use | use a custom config |
#### Example

```bash
$ ezunpaywall status
```
### ezu reports
Displays the contents of latest update report on ezunpaywall.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | report file installed on ezunpaywall |
| -l --latest | get the latest report |
| -s --status | status of report, success and error only accepted |
| -L --list | list of reports generated by ezunpaywall |
| -U --use | use a custom config |
#### Examples
```bash
# display the latest report
$ ezunpaywall report -la
# display the latest success report
$ ezunpaywall report -la -s success
# display the latest error report
$ ezunpaywall report -la -s error
# display the list of reports
$ ezunpaywall report -l
# display the list of success reports
$ ezunpaywall report -l -s success
# display the list of error reports
$ ezunpaywall report -l -s error
```
### ezu enrichJSON
Enriched a JSON file with attributes unpaywall.
By default, if no attributes is informed, we enriched with all attributes.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | file which must be enriched |
| -a --attributes | attributes which must be enriched (separeted by comma). By default, all attributes are added |
| -o --out | name of enriched file. By default, the output file is named: out.jsonl |
| -v --verbose | logs how much lines are enriched |
| -I --index  | name of the index from which the data will be retrieved |
| -U --use | use a custom config |
#### Examples
```bash
# enrich a file with all unpaywall attributes
$ ezunpaywall enricher -f ./pathOfFile.json
# enrich a file with graphql argument { is_oa, best_oa_location { license } }
$ ezunpaywall enricher -f ./pathOfFile.json -a "{ is_oa, best_oa_location { license } }"
```
### ezu enrichCSV
Enriched a CSV file with attributes unpaywall
by default, if no attributes is informed, we enriched with all attributes.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | file which must be enriched |
| -a --attributes | attributes which must be enriched (separeted by comma). By default, all attributes are added |
| -s --separator | separator of csv out file |
| -o --out | name of enriched file. By default, the output file is named: out.csv |
| -v --verbose | logs how much lines are enriched |
| -I --index  | name of the index from which the data will be retrieved |
| -U --use | use a custom config |
#### Examples
```bash
# enrich a file with all attributes
$ ezunpaywall enricher -f ./pathOfFile.csv
# enrich a file with graphql argument { is_oa, best_oa_location { license } }
$ ezunpaywall enricher -f ./pathOfFile.csv -a "{ is_oa, best_oa_location { license } }" -s ","
```

To see all available unpaywall attributes, [click here](https://github.com/ezpaarse-project/ez-unpaywall/tree/master#object-structure).

## Test

If you want to test all the commands, please install [ezunpaywall](https://github.com/ezpaarse-project/ez-unpaywall) and run it in [test mode](https://github.com/ezpaarse-project/ez-unpaywall#start)


Once ezunpaywall has been launched in test mode, you can run at the root of the node-ezunpaywall repository

```bash
$ npm run test
```