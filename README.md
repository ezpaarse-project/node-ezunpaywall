# node-ezunpaywall
> Tools for [ezunpaywall](https://github.com/ezpaarse-project/ez-unpaywall)
**Table of content**
- [Prerequisites](#prerequisites)
- [Installation](#Installation)
- [Configuration](#Configuration)
- [Global options](#Global-options)
- [Command line usage](#Command-line-usage)
- [Commands](#Commands)
## Prerequisites

The tools you need to let node-ezunpaywall run are :
* npm
* node 14.15.2
## Installation

```bash
$ npm i -g .
 ```
## Global options
| Name | Type | Description |
| --- | --- | --- |
| -V, --version | Boolean | Print the version number |
| -h, --help | Boolean | Show some help |

You can get help for any command by typing `node-ezunpaywall <command> --help`.
## Command line usage
The module provides an `ezunpaywall` command (aliased `ezu`).
## Commands
### ezu config
Update config to fetch ez-unpyawall.
#### parameters
| Name | Description |
| --- | --- |
| -u --url | ezunpaywall url |
| -p --port | ezunpaywall port |
| -f --file | display the configuration |
#### Example
```bash
$ ezunpaywall config -u http://localhost
$ ezunpaywall config -p 8080
```
### ezu ping
Check if service is available.
#### Example
```bash
$ ezunpaywall ping
```
### ezu update
Starts an unpaywall data update process. If you use "update" without parameter, it will download the last update published by unpaywall and insert its content. For automated this, it is possible to call this command via a cron (unpaywall publishes an update every Thursday UTC-7).
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | snapshot's file installed on ezunpaywall |
| -l --list | list of snapshot installed on ezunpaywall |
| -sd --startDate | start date to download and insert updates from unpaywall |
| -ed --endDate | end date to download and insert updates from unpaywall |
| -of --offset | line where processing will start |
| -li --limit | line where processing will end |
#### Examples
```bash
# insert all the content of the selected file on list
$ ezunpaywall update -l
# insert the content between line 1 000 and 400 000 of the selected file on list
$ ezunpaywall update -l -sl 1000 -el 400000
# insert all the content of fils.json.gz
$ ezunpaywall update -f ./file.jsonl.gz 
# insert the content between line 1 000 and 400 000 of fils.json.gz
$ ezunpaywall update -f ./file.jsonl.gz -sl 1000 -el 400000
# Downloads and inserts all updates from unpaywall between 2020-04-27 and now
$ ezunpaywall update -sd 2020-04-27
# Downloads and inserts all updates from unpaywall between 2020-04-27 and 2020-07-01 
$ ezunpaywall update -sd 2020-04-27 -se 2020-07-01
```

### ezu task
get status of processus in courses.

#### Examples

```bash
$ ezunpaywall task
```
### ezu reports
Displays the contents of latest update report on ezunpaywall.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | report file installed on ezunpaywall |
| -l --list | list of reports generated by ezunpaywall |
| -la --latest | get the latest report |
| -s --status | status of report, success and error only accepted |
#### Examples
```bash
# display the latest report
$ ezunpaywall report -la
# display the latest success report
$ ezunpaywall report -la -s success
# display the latest error report
$ ezunpaywall report -la -s error
# display the list of all reports
$ ezunpaywall report -l
# display the list of success reports
$ ezunpaywall report -l -s success
# display the list of error reports
$ ezunpaywall report -l -s error
```
### ezu enrichJSON
Enriched a JSON file with attributes unpaywall.
By default, if no attributes is informed, we enriched with all attributes.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | file which must be enriched |
| -a --attributes | attributes which must be enriched (separeted by comma). By default, all attributes are added |
| -o --out | name of enriched file. By default, the output file is named: out.jsonl |
| -v --verbose | logs how much lines are enriched |
#### Examples
```bash
# enrich with all attributes
$ ezunpaywall enricher -f ./pathOfFile.json
# enrich only with oa_status and best_oa_location.url
$ ezunpaywall enricher -f ./pathOfFile.json -a oa_status best_oa_location.url
```
### ezu enrichCSV
Enriched a CSV file with attributes unpaywall
by default, if no attributes is informed, we enriched with all attributes.
#### Parameters
| Name | Description |
| --- | --- |
| -f --file | file which must be enriched |
| -a --attributes | attributes which must be enriched (separeted by comma). By default, all attributes are added |
| -s --separator | separator of csv out file |
| -o --out | name of enriched file. By default, the output file is named: out.jsonl |
| -v --verbose | logs how much lines are enriched |
#### Examples
```bash
# enrich with all attributes
$ ezunpaywall enricher -f ./pathOfFile.csv
# enrich only with oa_status and best_oa_location.url
$ ezunpaywall enricher -f ./pathOfFile.csv -a oa_status best_oa_location.url -s ","
```

To see all available unpaywall attributes, [click here](https://github.com/ezpaarse-project/ez-unpaywall/tree/master#object-structure).